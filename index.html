<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexToon | Premium Anime & Cartoons</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary-accent: linear-gradient(135deg, #6e8efb, #a777e3);
            --dark-bg: #1a1c2c;
            --card-border: #e2e8f0;
            --text-heading: #1e293b;
            --gray: #64748b;
            --new-badge: #ff4757;
            --ongoing: #2ed573;
            --finished: #ffa502;
            --toon-red: #d63031; /* UI theke neya red color */
        }

        body { margin: 0; font-family: 'Poppins', sans-serif; background-color: #f8fafc; color: #334155; }

        header {
            background: var(--dark-bg); padding: 15px 20px; display: flex;
            justify-content: space-between; align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000;
        }
        .logo { font-weight: 700; font-size: 22px; background: var(--primary-accent); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; letter-spacing: 1px; }
        .icon-btn { color: white; font-size: 20px; cursor: pointer; }

        #search-container {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark-bg); align-items: center; padding: 0 20px; box-sizing: border-box;
        }
        #search-input { width: 100%; background: transparent; border: none; color: white; font-size: 16px; outline: none; padding: 10px; }

        #side-menu { position: fixed; top: 0; left: -300px; width: 280px; height: 100%; background: var(--dark-bg); transition: 0.4s; z-index: 2000; padding: 20px 10px; border-radius: 0 20px 20px 0; }
        #side-menu.active { left: 0; }
        .menu-item { padding: 12px 20px; color: #cbd5e1; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; margin-bottom: 5px; }
        #overlay { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(4px); z-index: 1500; }

        .feed { padding: 20px; max-width: 900px; margin: auto; }
        .post-card { background: white; border-radius: 16px; overflow: hidden; margin-bottom: 25px; border: 1px solid var(--card-border); cursor: pointer; transition: 0.3s; position: relative; }
        .post-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .post-thumb { width: 100%; aspect-ratio: 16 / 9; object-fit: cover; display: block; background: #eee; }
        .post-content { padding: 20px; text-align: left; } 
        .badge-container { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
        
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; color: white; }
        .quality-badge { background: #f1f5f9; color: #64748b; }
        .new-badge { background: var(--new-badge); }
        .status-badge.ongoing { background: var(--ongoing); }
        .status-badge.finished { background: var(--finished); }

        .post-title { margin: 0 0 12px 0; font-size: 19px; line-height: 1.4; color: var(--text-heading); font-weight: 600; text-align: left; }
        .post-meta { display: flex; gap: 20px; font-size: 13px; color: #94a3b8; justify-content: flex-start; }
        .post-meta i { color: #6e8efb; margin-right: 5px; }

        /* --- New Pagination & Latest Uploads Styles --- */
        .pagination-container { display: flex; justify-content: center; align-items: center; gap: 5px; margin: 30px 0; flex-wrap: wrap; }
        .page-btn { padding: 8px 12px; border: 1px solid #ddd; background: white; cursor: pointer; border-radius: 4px; font-weight: 600; color: #333; font-size: 14px; }
        .page-btn.active { background: var(--toon-red); color: white; border-color: var(--toon-red); }
        .page-btn.nav-btn { background: var(--toon-red); color: white; border: none; padding: 8px 18px; }
        .page-btn:disabled { background: #eee; color: #999; cursor: not-allowed; }

        .latest-uploads-container { background: white; border: 1px solid #eee; border-radius: 8px; margin-top: 10px; overflow: hidden; }
        .latest-header-bar { background: #222; color: white; padding: 12px 15px; font-size: 14px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .latest-item { padding: 12px 15px; border-bottom: 1px solid #f1f1f1; font-size: 14px; color: #d63031; cursor: pointer; font-weight: 500; transition: 0.2s; display: block; text-decoration: none; }
        .latest-item:hover { background: #fdf2f2; }
        .latest-item:last-child { border-bottom: none; }

        /* --- Telegram Section Styles --- */
        .section-title-bar { background: #333; color: white; padding: 10px 15px; font-size: 13px; font-weight: 700; text-transform: uppercase; margin-top: 25px; border-radius: 4px 4px 0 0; display: inline-block; }
        .telegram-box { background: white; border: 1px solid #eee; padding: 15px; border-radius: 0 4px 4px 4px; text-align: center; }
        .telegram-box img { max-width: 100%; height: auto; border-radius: 8px; cursor: pointer; }

        /* --- New Telegram Alert Animation --- */
        .telegram-alert {
            position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%);
            background: #242939; color: white; padding: 12px 20px; border-radius: 12px;
            display: flex; align-items: center; gap: 15px; z-index: 3000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); width: 90%; max-width: 400px;
            transition: 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .telegram-alert.show { bottom: 20px; }
        .tg-icon { font-size: 24px; color: #0088cc; }
        .tg-text { flex-grow: 1; font-size: 13px; line-height: 1.4; }
        .tg-btn { 
            background: #0088cc; color: white; border: none; padding: 6px 15px; 
            border-radius: 6px; font-weight: 700; font-size: 12px; cursor: pointer;
            text-decoration: none;
        }
        .tg-close { cursor: pointer; font-size: 18px; opacity: 0.6; }

        /* --- Copyright Footer Styles --- */
        footer { background: #1a1c2c; color: #94a3b8; padding: 30px 20px; text-align: center; margin-top: 50px; border-top: 3px solid var(--toon-red); }
        .footer-copy { font-size: 13px; font-weight: 500; margin-bottom: 5px; }
        .footer-link { color: #6e8efb; text-decoration: none; font-weight: 700; text-transform: uppercase; }

        /* --- Details Page --- */
        #post-details { display: none; background: white; min-height: 100vh; }
        .main-container { max-width: 650px; margin: auto; padding: 15px; }
        .title-detail { font-size: 22px; font-weight: 600; color: #333; margin: 15px 0; padding-bottom: 10px; text-align: left; border-bottom: 2px solid #f1f2f6; }
        #det-img { width: 100%; height: auto; border-radius: 12px; display: block; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .info-section { border: 1px solid #eee; padding: 20px; border-radius: 8px; margin: 20px 0; background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .info-item { display: flex; margin-bottom: 8px; font-size: 15px; }
        .info-label { color: #e74c3c; font-weight: 700; width: 100px; flex-shrink: 0; }
        .info-value { color: #576574; font-weight: 500; }
        .center-text { text-align: center; font-weight: 800; color: #d63031; margin: 30px 0 20px 0; font-size: 18px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .season-wrapper { display: flex; overflow-x: auto; gap: 10px; padding: 10px 5px; margin-bottom: 20px; scrollbar-width: none; }
        .season-wrapper::-webkit-scrollbar { display: none; }
        .season-tab { padding: 10px 20px; background: #f1f5f9; border-radius: 30px; white-space: nowrap; font-weight: 600; color: #64748b; cursor: pointer; transition: 0.3s; border: 1px solid #e2e8f0; }
        .season-tab.active { background: var(--primary-accent); color: white; border-color: transparent; box-shadow: 0 4px 10px rgba(110, 142, 251, 0.3); }
        .ep-accordion { border: 1px solid #eef2f7; border-radius: 4px; margin-bottom: 8px; }
        .ep-header { background: #fff; padding: 15px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; color: #2d3436; font-weight: 500; }
        .ep-content { display: none; padding: 20px; background: #fdfdfd; text-align: center; border-top: 1px solid #f1f1f1; }
        .ep-content.active { display: block; }
        .res-container { display: flex; flex-direction: column; gap: 10px; align-items: center; }
        .dl-res-btn { width: 90%; max-width: 300px; color: white; padding: 12px; border-radius: 6px; text-decoration: none; font-weight: 600; display: inline-block; font-size: 14px; transition: 0.3s; }
        .btn-480p { background: #3498db; }
        .btn-720p { background: #2ecc71; }
        .btn-1080p { background: #e67e22; }
        .btn-2k { background: #8e44ad; }
        .btn-4k { background: #c0392b; }
        .dl-res-btn:hover { opacity: 0.85; transform: scale(1.02); }
        .more-episodes-msg { text-align: center; padding: 40px 10px; color: #576574; font-weight: 700; font-size: 15px; letter-spacing: 0.5px; line-height: 1.6; }
        .how-to-download { border-top: 1px solid #f1f1f1; padding: 25px 15px; text-align: center; font-size: 13px; color: #2d3436; font-weight: 600; line-height: 1.5; }
        .how-to-download span { color: #ff4757; cursor: pointer; text-decoration: underline; }
        .rec-title { font-size: 18px; font-weight: 700; color: var(--text-heading); margin: 30px 0 15px 0; border-left: 4px solid #6e8efb; padding-left: 10px; }
        #loading-state { text-align: center; padding: 100px 20px; color: var(--gray); font-weight: 600; }
        .back-btn { background: #f1f2f6; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-bottom: 10px; font-weight: 600; color: #576574; }
    </style>
</head>
<body>

<div id="overlay" onclick="toggleMenu()"></div>

<div id="tg-alert" class="telegram-alert">
    <div class="tg-icon"><i class="fab fa-telegram"></i></div>
    <div class="tg-text">
        <b>NexToon Community</b><br>
        Join our telegram channel for latest updates.
    </div>
    <a href="https://t.me/your_telegram_channel" id="tg-alert-btn" target="_blank" class="tg-btn">JOIN</a>
    <div class="tg-close" onclick="closeTgAlert()">&times;</div>
</div>

<header>
    <div class="icon-btn" onclick="toggleMenu()"><i class="fas fa-align-left"></i></div>
    <div class="logo" onclick="showHome()">NEXTOON</div>
    <div class="icon-btn" onclick="toggleSearch()"><i class="fas fa-search"></i></div>
    <div id="search-container">
        <i class="fas fa-arrow-left icon-btn" onclick="toggleSearch()" style="margin-right: 15px;"></i>
        <input type="text" id="search-input" placeholder="Search anime or cartoons..." onkeyup="filterPosts()">
    </div>
</header>

<nav id="side-menu">
    <div class="menu-item" onclick="showHome()"><i class="fas fa-home"></i> Home</div>
    <div class="menu-item">Movie Library <i class="fas fa-chevron-right" style="font-size: 10px;"></i></div>
    <div class="menu-item">Animated Series <i class="fas fa-chevron-right" style="font-size: 10px;"></i></div>
</nav>

<div id="home-page">
    <div id="loading-state"><i class="fas fa-circle-notch fa-spin fa-2x"></i><br><br>Loading NexToon...</div>
    <div class="feed">
        <div id="post-feed"></div>
        
        <div id="pagination" class="pagination-container"></div>

        <div class="latest-uploads-container">
            <div class="latest-header-bar">
                <i class="fas fa-bolt"></i> Latest Uploads
            </div>
            <div id="latest-list"></div>
        </div>

        <div class="section-title-bar">JOIN US ON TELEGRAM</div>
        <div class="telegram-box">
            <a href="https://t.me/your_telegram_channel" id="tg-banner-link" target="_blank">
                <img src="https://i.ibb.co/VWV3p6C/telegram-banner.png" id="tg-banner-img" alt="Join our Telegram Channel">
            </a>
        </div>

        <footer>
            <div class="footer-copy">Copyright © 2012-2026. All Rights Reserved by</div>
            <a href="#" class="footer-link" onclick="showHome()">NEXTOON</a>
        </footer>
    </div>
</div>

<div id="post-details">
    <div class="main-container">
        <button class="back-btn" onclick="showHome()"><i class="fas fa-arrow-left"></i> Back</button>
        <h1 class="title-detail" id="det-title"></h1>
        <div style="text-align: center;"><img id="det-img" src="" alt="Full Poster"></div>
        <div class="info-section">
            <div class="info-item"><span class="info-label">Genre:</span> <span class="info-value" id="det-genre"></span></div>
            <div class="info-item"><span class="info-label">Language:</span> <span class="info-value" id="det-lang"></span></div>
            <div class="info-item"><span class="info-label">Quality:</span> <span class="info-value" id="det-quality"></span></div>
            <div class="info-item"><span class="info-label">Status:</span> <span class="info-value" id="det-status"></span></div>
            <div class="info-item"><span class="info-label">Encoder:</span> <span class="info-value" id="det-encoder">NexToon</span></div>
        </div>
        
        <div class="center-text">⚡ SELECT SEASON ⚡</div>
        <div class="season-wrapper" id="season-tabs"></div>

        <div class="center-text">⚡ DOWNLOAD / WATCH LINKS ⚡</div>
        <div id="ep-list-container"></div>
        
        <div id="ongoing-msg" class="more-episodes-msg">MORE EPISODES WILL BE ADDED<br>AFTER RELEASE...</div>
        <div class="how-to-download">HOW TO DOWNLOAD MOVIES AND SERIES FROM<br>HERE? <span id="guide-btn">CLICK HERE</span></div>
        
        <div class="rec-title">Recommended For You</div>
        <div id="recommended-feed" style="padding-bottom: 30px;"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDpB4bszvFjBNC2WvhTSgFYf2Y0m_StVWM",
        authDomain: "oonj-def3e.firebaseapp.com",
        projectId: "oonj-def3e",
        storageBucket: "oonj-def3e.firebasestorage.app",
        messagingSenderId: "648217288200",
        appId: "1:648217288200:web:09001453584950b567fbbd"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let allPosts = [];
    let currentEpisodes = [];
    
    // Pagination Variables
    let currentPage = 1;
    const postsPerPage = 10;

    function toggleMenu() {
        const menu = document.getElementById('side-menu');
        const overlay = document.getElementById('overlay');
        menu.classList.toggle('active');
        overlay.style.display = menu.classList.contains('active') ? 'block' : 'none';
    }

    function toggleSearch() {
        const searchContainer = document.getElementById('search-container');
        if (searchContainer.style.display === 'flex') {
            searchContainer.style.display = 'none';
            document.getElementById('search-input').value = '';
            currentPage = 1;
            renderPosts(allPosts);
        } else {
            searchContainer.style.display = 'flex';
            document.getElementById('search-input').focus();
        }
    }

    function filterPosts() {
        const keyword = document.getElementById('search-input').value.toLowerCase();
        const filtered = allPosts.filter(post => post.title.toLowerCase().includes(keyword));
        currentPage = 1;
        renderPosts(filtered);
    }

    async function loadSystemSettings() {
        try {
            const doc = await db.collection('systemConfig').doc('homePage').get();
            if(doc.exists) {
                const data = doc.data();
                if(data.telegramLink) {
                    document.getElementById('tg-alert-btn').href = data.telegramLink;
                    document.getElementById('tg-banner-link').href = data.telegramLink;
                }
                if(data.telegramBanner) {
                    document.getElementById('tg-banner-img').src = data.telegramBanner;
                }
            }
        } catch (e) { console.error("System settings load error:", e); }
    }

    async function loadData() {
        const loader = document.getElementById('loading-state');
        try {
            await loadSystemSettings();
            const snapshot = await db.collection('posts').orderBy('createdAt', 'desc').get();
            loader.style.display = 'none';
            allPosts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderPosts(allPosts);
            renderLatestList();
            
            setTimeout(() => {
                document.getElementById('tg-alert').classList.add('show');
            }, 2000);

        } catch (error) { loader.innerHTML = "Error loading content."; }
    }

    function closeTgAlert() {
        document.getElementById('tg-alert').classList.remove('show');
    }

    function renderPosts(posts) {
        const feed = document.getElementById('post-feed');
        const startIndex = (currentPage - 1) * postsPerPage;
        const endIndex = startIndex + postsPerPage;
        const paginatedPosts = posts.slice(startIndex, endIndex);

        let html = '';
        paginatedPosts.forEach(post => {
            let newBadgeHtml = '';
            if(post.createdAt) {
                const postDate = post.createdAt.toDate();
                const diffDays = Math.ceil(Math.abs(new Date() - postDate) / (1000 * 60 * 60 * 24));
                if(diffDays <= 7) newBadgeHtml = `<span class="badge new-badge">NEW</span>`;
            }
            const statusClass = (post.status || 'Ongoing').toLowerCase();
            html += `
                <article class="post-card" onclick="openDetails('${post.id}')">
                    <img src="${post.image}" class="post-thumb">
                    <div class="post-content">
                        <div class="badge-container">
                            <span class="badge quality-badge">${post.quality}</span>
                            ${newBadgeHtml}
                            <span class="badge status-badge ${statusClass}">${post.status || 'Ongoing'}</span>
                        </div>
                        <h2 class="post-title">${post.title}</h2>
                        <div class="post-meta">
                            <span><i class="fas fa-calendar-alt"></i> ${post.date || 'New'}</span>
                            <span><i class="fas fa-film"></i> ${post.genre || 'Action'}</span>
                        </div>
                    </div>
                </article>
            `;
        });
        feed.innerHTML = html || '<p style="text-align:center; padding:50px;">No results found.</p>';
        renderPagination(posts.length);
    }

    function renderPagination(totalItems) {
        const paginationContainer = document.getElementById('pagination');
        const totalPages = Math.ceil(totalItems / postsPerPage);
        
        if (totalPages <= 1) {
            paginationContainer.innerHTML = '';
            return;
        }

        let pgHtml = '';
        pgHtml += `<button class="page-btn nav-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">< PREV</button>`;
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                pgHtml += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
            } else if (i === currentPage - 2 || i === currentPage + 2) {
                pgHtml += `<span style="padding: 5px;">...</span>`;
            }
        }
        pgHtml += `<button class="page-btn nav-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">NEXT ></button>`;
        paginationContainer.innerHTML = pgHtml;
    }

    function changePage(page) {
        currentPage = page;
        window.scrollTo(0, 0);
        renderPosts(allPosts);
    }

    function renderLatestList() {
        const latestDiv = document.getElementById('latest-list');
        const latestPosts = allPosts.slice(0, 15);
        
        latestDiv.innerHTML = latestPosts.map(post => {
            // Logic to get the latest episode info
            let seasonText = "";
            let episodeText = "";
            if(post.episodes && post.episodes.length > 0) {
                // Get the last episode added to the array
                const lastEp = post.episodes[post.episodes.length - 1];
                seasonText = ` Season ${lastEp.season || '1'},`;
                episodeText = ` ${lastEp.name || 'New Episode'}`;
            }
            
            const lang = post.lang || "Multi";
            
            // Format: Title + Season + Episode + [Language] + Added
            return `<a href="javascript:void(0)" class="latest-item" onclick="openDetails('${post.id}')">
                ${post.title}${seasonText}${episodeText} [${lang}] Added
            </a>`;
        }).join('');
    }

    async function openDetails(id) {
        document.getElementById('home-page').style.display = 'none';
        document.getElementById('post-details').style.display = 'block';
        window.scrollTo(0,0);
        
        const epList = document.getElementById('ep-list-container');
        const seasonTabs = document.getElementById('season-tabs');
        epList.innerHTML = '<div style="text-align:center; padding:20px;">Fetching links...</div>';
        seasonTabs.innerHTML = '';

        const doc = await db.collection('posts').doc(id).get();
        if(doc.exists) {
            const data = doc.data();
            document.getElementById('det-title').innerText = data.title;
            document.getElementById('det-img').src = data.image;
            document.getElementById('det-genre').innerText = data.genre || 'N/A';
            document.getElementById('det-lang').innerText = data.lang || 'N/A';
            document.getElementById('det-quality').innerText = data.quality || 'N/A';
            document.getElementById('det-status').innerText = data.status || 'Ongoing';

            const guideBtn = document.getElementById('guide-btn');
            guideBtn.onclick = () => (data.downloadGuide && data.downloadGuide !== "#") ? window.open(data.downloadGuide, '_blank') : alert('Tutorial not available.');

            document.getElementById('ongoing-msg').style.display = (data.status && data.status.toLowerCase() === 'finished') ? 'none' : 'block';

            currentEpisodes = data.episodes || [];
            
            if(currentEpisodes.length > 0) {
                let seasons = [...new Set(currentEpisodes.map(ep => ep.season || "1"))];
                seasons.sort((a, b) => a - b);

                seasons.forEach((s, index) => {
                    const tab = document.createElement('div');
                    tab.className = `season-tab ${index === 0 ? 'active' : ''}`;
                    tab.innerText = `Season ${s}`;
                    tab.onclick = () => {
                        document.querySelectorAll('.season-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        renderEpisodes(s);
                    };
                    seasonTabs.appendChild(tab);
                });
                renderEpisodes(seasons[0]);
            } else {
                epList.innerHTML = '<p style="text-align:center; color:gray; padding:20px;">No episodes found.</p>';
            }
            showRandomRecommendations(id);
        }
    }

    function renderEpisodes(seasonNum) {
        const epList = document.getElementById('ep-list-container');
        const filtered = currentEpisodes.filter(ep => (ep.season || "1") == seasonNum);
        
        let episodeHtml = '';
        filtered.forEach((ep) => {
            let btnHtml = '';
            if(ep.link480) btnHtml += `<a href="${ep.link480}" class="dl-res-btn btn-480p" target="_blank">Download 480p</a>`;
            if(ep.link720) btnHtml += `<a href="${ep.link720}" class="dl-res-btn btn-720p" target="_blank">Download 720p</a>`;
            if(ep.link1080) btnHtml += `<a href="${ep.link1080}" class="dl-res-btn btn-1080p" target="_blank">Download 1080p</a>`;
            if(ep.link2k) btnHtml += `<a href="${ep.link2k}" class="dl-res-btn btn-2k" target="_blank">Download 2K HD</a>`;
            if(ep.link4k) btnHtml += `<a href="${ep.link4k}" class="dl-res-btn btn-4k" target="_blank">Download 4K Ultra HD</a>`;

            episodeHtml += `
                <div class="ep-accordion">
                    <div class="ep-header" onclick="toggleAccordion(this)">
                        <span>${ep.name}</span>
                        <i class="fas fa-plus"></i>
                    </div>
                    <div class="ep-content">
                        <div class="res-container">
                            ${btnHtml || '<p style="color:red">No links available</p>'}
                        </div>
                    </div>
                </div>
            `;
        });
        epList.innerHTML = episodeHtml;
    }

    function showRandomRecommendations(currentId) {
        const recFeed = document.getElementById('recommended-feed');
        const others = allPosts.filter(p => p.id !== currentId);
        const shuffled = others.sort(() => 0.5 - Math.random());
        const selected = shuffled.slice(0, 5);

        let html = '';
        selected.forEach(post => {
            const statusClass = (post.status || 'Ongoing').toLowerCase();
            html += `
                <article class="post-card" onclick="openDetails('${post.id}')" style="margin-bottom: 20px;">
                    <img src="${post.image}" class="post-thumb">
                    <div class="post-content" style="padding: 15px;">
                        <div class="badge-container">
                            <span class="badge quality-badge">${post.quality}</span>
                            <span class="badge status-badge ${statusClass}">${post.status || 'Ongoing'}</span>
                        </div>
                        <h2 class="post-title" style="font-size: 16px;">${post.title}</h2>
                    </div>
                </article>
            `;
        });
        recFeed.innerHTML = html || '<p style="text-align:center; color:gray;">No recommendations yet.</p>';
    }

    function toggleAccordion(el) {
        const content = el.nextElementSibling;
        const icon = el.querySelector('i');
        const isActive = content.classList.contains('active');
        document.querySelectorAll('.ep-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.ep-header i').forEach(i => i.classList.replace('fa-minus', 'fa-plus'));
        if(!isActive) {
            content.classList.add('active');
            icon.classList.replace('fa-plus', 'fa-minus');
        }
    }

    function showHome() {
        document.getElementById('home-page').style.display = 'block';
        document.getElementById('post-details').style.display = 'none';
        currentPage = 1;
        renderPosts(allPosts);
    }

    loadData();
</script>
</body>
</html>
